@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager NavigationManager
@inject IAppSettingsService AppSettingsService
@inject IAuthService AuthService

@code {
    /// <summary>
    /// Componente que redirige a la página apropiada cuando el usuario no está autorizado
    /// Redirige a /initial-config si la app no está configurada, o a /login si no está autenticado
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Primero verificar si el usuario está autenticado
            var isAuthenticated = await AuthService.IsAuthenticatedAsync();
            
            if (isAuthenticated)
            {
                // Si está autenticado, redirigir a la página principal
                NavigationManager.NavigateTo("/cards", true);
                return;
            }

            // Verificar si la aplicación está configurada
            var isConfigured = await AppSettingsService.IsConfiguredAsync();
    
            
            if (!isConfigured)
            {
                // Si no está configurada, redirigir a configuración inicial
                NavigationManager.NavigateTo("/initial-config", true);
            }
            else
            {
                // Si está configurada pero no autenticado, redirigir a login
                NavigationManager.NavigateTo("/login", true);
            }
        }
        catch (Exception)
        {
            // En caso de error, redirigir a login por seguridad
            NavigationManager.NavigateTo("/login", true);
        }
    }
}